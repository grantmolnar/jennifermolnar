<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Private preview</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Private preview</p>
                        <p>Enter the preview password.</p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"927b1d3bfa531d341d95d044515e5ed8dd8a7fa791e0b64e11fa719ae865a692f1a1bf6524c8190e2aedf690ab724c273937b49069fec486a89323edd336511d0c97e87ab8552684be734588567d8bb9a0851af6461dac2005694207e950e3da5beaa9c037a6ad1f4e8461d53b3fbd2a390634b5550d51d09098ae35e7c2bb26549dfaea35b0d19e7fb6b5de6bc3b91b110915db35e828e19371365b52e9ed7268c4ac6395d1e18d7eee728981601e67a417c8d0c430f40f0a84f9f152f037139e097f10c070c4724063a906b39ea6de027c63471fa6f768ae5e91c0f19a749a4f96cc0dc6a57fe9afe35b860b2dcaf18146ff1f640850c0fbfda74070ac60989a2d8302227550c1a9c8229ffc5f90bc3890c390ab8bc375022b1316ca21d52c590fa3658a49c23bc23c6e83a24c931269930e6f93e608df6ad56220c2701f963d8f085611fd325296ea2e6d8ddbb0a53d330ff4674fa744d716a3d943dfb285bace6d30f7c2c52c6c0cccd6d4cca2d562431be25c3993cfbc1019c2c8a77253edcf3ed632e2c97fdb3a98eb6ce2118af5dcb671ab6b4d270dabb21e5649bd02ee2f29499677699e95b1aa4fedc2c303c7f59f4c31275c2398ea017e08cd054eb58d12247399c04c2e90a2afc8851c5a84ac241703cd02b87f0eaaa57332941ab1225eb8db3e98e61435ebc1998117356dad2e6dc3aef26cfa1003f97c751b5baa93398b14ab4d345e724c7b08cc988fb46b0a8ec88c4a5dc4f13784913af6683e119a89d216ffd20c898f61b9cd8e4868b0fb3acb6460d341fe53ceeec008fac38b1b306a4a6878a512088a8fe37e0e8169ae9a442623b37d9c6ed34bfb8fe704925eb882f78905e5a76c994929f782d131ea06904eaa3937315fecb8583170fe0aa02f9f43b2902911bbced126f32e8fbcfb54f40c134a2e72fc1cef57251fc69a44641dc8dce061ddb659314ff6dd9d94ae2e07526bb031f6d56bda846fb130d46aa73d14d699a908c62cc2e1367bee6ab4f4ed32660f5c1c9130537df9e6a73eec650066c23e750adb034ece32b33c591cb61cdac174495e4e2d51844314ee6aa7396881cc26da770a4c19862be9f0a710bbf5d83f08af4c63a3fa0125809b03e4beea6a783db79966c6ff438ceeaf92305a8befe76fa54fe150ac6eed5da50ba7a47e57550642778268005d5696518ff4b1ea9d570f66348fbccf96254877ca346333f8d05b6569e42c475d81512dece83c352b1c7cb7c4b7218f24d2ce8cb13915186cec33931ba594f7c2fe04167ad19be58ca25675995d815677962590cb1d9af250fdc487d59fd95af4e31b31ea87cf0cdd6f9a299000d89823fe88a2cfb4f90078ea653dd57d44fd340fa022e881315fdafd980a3e160bf3ffb61055ec6d90ddb3b18c7055b8884df92be80be4c03b94ea08537cd28054f5c1c94627f83a35420af6f6eb4eb78327e2ac040a5bb573486559ac45a249a71d85c86e959203b931a141f5de6f236eb754bb230d69a6577610011fac8bca821556fa6908082131707ecd5c905e97aacb4874db0f4523e2c49884cb1ed31145856e09479cc335fd485ad1793b11a4ca51b5ebda1edbcce541ec5f0b5ac371f8dd806acbdfa638ead5743debe07d97dd0e0510a871edf48489b53b5421e17758951ea73d40925d1b0008772223c89319b731484a9f2e75101357fc26b0c3bcc51824aa1b8170ea125f86bafba9dfb6c12da2dae2545620c832dc7d82440201c026bb968a007ffbd4f14308d45c6862f054494a4500be94cc3566a1aa50286b203b8cc18aecfd17ecdc100d3dcf027cbfdccb4b83de3176316840fccdec87bab58ac3cf51aa7e58bb2b29a9685dbd0d851534655c2872bba8413dc535fbb38e70b8010d6b482fe0efb442ac93327c962eec20900c4e468ee5a2b07528af35b3638f171ca9a473a4fb69998ddb1bfb5caacca0a11056d448e349f108c5820f7af2bcbc91a8dbe68bec821150f317b0de96fd0382b57a0e3e7acc3fa00f966adefcb0a6faad2c320fdabf89911640eda437617417b1c544189ed7845fab59814fdcca48752b6c05560d95ae5e3cc9121bc769c6ba60c90f484f594c13334496bd9590b0c38908c9d8af4689bb2f1579d3d9c7eba19d156c63ea684c91e233ff89b761c5b7b93c4b545e19f7e8a3a495d8e9927f500d24f0b988d7250bbd386125ad68b1801c1f278934e38e172a914f666fd89cd181d22c99a72a230a7a6cdfb8c392016a70c8908df274ae1545e29fcd8d19fc122b96181dfc59c0d1255067b2b09ff316f798bbd9a5856267dc0ab8ecf8111315c51c21f9180697ced8c606452ebdd569835d139c68eb6ec28aae3a64340c865d490371f03d68df969cbee8e382b8a51cae9110a22286645bc447334611b29abdc9ad076427aacc35d5531a81dd11ace41acc6f77744e7f8b324bcfa87e57f94de0ad68d99bc7877dabc5363de4dbcccd016d161c8d75836c5f2639a2f0f9932380431b37b6cee1f775f12017d5ef712535f06984de12bd9dfe999c1a7434f4b30cb367dda41c7d9d66db2931b0418c3d25771400358549c08261ade45a415d4414e2c1cd785fbb93bdca5fb14c68bec1d33a9c95570db6940dc4152919dd9e53d9f86bc0a1a5e65441f0f44b937eaf404a750f136382ca7cdf4e0dd3f31bfa9b8f3fd31a0e0bc10ee887b24cf49d371c5250844d883c369939ca9b1580e2adf26b8a5cc074aea79c65aecdae1d25547fc69e9ff2431fc16a0855d085faa1f8fe1c2c48ed76d1931f73e338e38654419f71fffaaaddfb537d7b9a5e6a5e322137015feddea76da331bdce8b549566ad9f6f7e7246083569e02aac89991cbc179278e9b3677fe14a868e940d55c8a682e828a92020779674a21d124e79ae7c3bee4631c08f8decc4a3395d6bc33ddacc5c3c10a57aee93a74be6d3047d2f2394bc567b13f2ebb74bd9e8269065f4393779dab8ce333261f19e413fde94bab40877ef3159faace8e51ea13382c99c109167e6d80af4dd791b624c67e072c1d148b5cefce71e849a1a7ae48b4e7addecd0f4ffd7021e99b4b67092ea35380f4612768c74a530d79ae63536e212ac7fa1a6a5d311c33956f17c2b40df36cbd8411eb1cf18c0ec2281999048084c13f7eaa0f22f63dfa85ca2fa062c85660c7ce0cb2319cb84a060fe548b314e2097fe1e0377981547acf2824b81b437ab98c6bd121eb0829e75cb753845bed5b0c7d99e039e044ae83d7d87abc60a93f46559a484a7af7988b62bc8fbd893c6c14b087a92fd32912fa49b111c957d3328eb1d9cccb7298ea7647a77895bb6996f18bc513f0b4b00d8c8cf5cf5fbfc8ab157d022bc39a7dde147c8660c6123c7ae3faa9ddb2119421bc4193afa39d04d5dd0f4a4427e4d09ced7bd40c67e7124be8fd245256e06c7d55d493501dda6b5207d30da24661bcd011c6aabe194fae696fb1108fead7c19b9a8d6d2015f735aed4cc7b9c5425fa342b272ce1a4ad771688d8c7a0264d90890cdaad99c24ed7f72e77be033ffcdd46c70c163cb4c45bb57737c7da7154de8a1ba56cb03b5c2e7f55d223926cadb567054ff762a709d6d099af6714a10279e7b39d8f0e5a41246822230b564b75b3fbea06dfd1fec1a6c35ac7db9d3dc5cbcb78847ad2385542f903b9eec3f1e129c9b960ea00a1c08170b4d47b4f6b9f91d189eb6d598d365ced3e8d1ef1590368bce25fef07d87bd0b002cf6bebee1386db004e8e6304f72b3496f43dfc4ca841df6e3e71836dc99de9130ba131f1ef31ab214939d5925ca23d9931d0c5f976e51e59af3656913373260f34c3cbb1d08a62a5198813fbf2c3d1e3fbed2ebf34ac5e6024ba6935dba0c499b48e8d5a704cebe8e7f11cf791c81f1ef6ffc62225225e2e3ef9cc50ee1cc1d4df03dd7f35fbb41dcd02ac478c2094bbf133da08e3a0c8f47681aa73794b39a0a84b4d34db9dbb905d22960b9ff8869f61cf17efff6a665f4d30a1e41a8c46f58badaa88c2b6d734a55316e303c2b3ee1f9e55c7d1d2ebcf06e57277961423e64ea86f7325b9e7a2840f32652d1d8988d47a7a5dbd95d584240514986f7c64de0a431d118594063ef0ce0104569be49d3a38f069d467953fbebf26f7090076a82a79af9c59ea8490498087d40ed2a0e1ce05af55479ee0b6bd33d10f5aa4135eedd59a18642122ab1090609204d95a814434996b788a3c4f033286d97f385ccd8ec55d21c3dd3cd17956a35b91a61f7f02198be7dbe51bb2eec7a26013fc0ffa0cf8f4b611357dccfe055b726239292139563e04d7f399a7eca4f99d21952947d93d7950870fe28701376c7ae624b758691522daa7f902373de2ced34131b29afb3e58f1be33fe79640b32509aa1f25d4eead2376fb9a66da56f2014eb4f61feae32efdd8bef49e0f51638b4b0a7c1565d458d5048973a45a2f484f829247c820b2ec4d8d591c5ffb3afdde47e9cd7f834ccd4711d78f71fe4c4467728794a3abc45d096069fa06920debb43a84be23da87012d41c8987838e33ba56ad4ceea6dc82717214a0f613b9e451a99684975c830bc7a954c6ed669bf951f3102309ccedaa674b9818aac6074b7f2f3713590553c7a34e0411cb76e04c33b3115cf9652f7a881811c967b0932b298941c0d37ec24942e81ccca41b80d344b4af3bcc7db3bd6241a0a5667a30e292276e18ae0ef02992111c01844b2fe4b9c875c075e7972b9d27f182975d8b1b2a103f9372fd34530ec8cc93c85b3464d26df8d04749f74bd2f18d7c9371a3175124349726373e0eba202fa8f2a46fd1983481df0686fd6313f2389403812967cfecaa7f986ee832dbc86926180f109189c95f0faac1cc78af82a23c833f1fb17fbe67455a7782c2741bd9d7a42610d321d97587a5ec9176268ae5bac110cc611cf8597005d47d0652739ec2bd7c0accf2b6e878bb5e80aa6f115e3f7c24546fdb64c7484c30e527c6d0e2ef7c5a8376194b14d3c299653f95adcc3d6ea5c682824c3c70a3c911e4daa668029d06dcd24af7f0819ad114cc9e31f25afa115b42f2e99e3bc5459643960629d13d2a4184e8dbe9a44c6500fdd5d927ac1ddd5e583c6dcd3d5702cac862558d97aedbd52114c1d80d32c9873ead70c2f12364d3a14db8ff152220ae2f0ee7c461387a0223ab3ac073a38709509fd33783fcc4e9e26e53eab0ab2170c93bcd1dcdaa6b19ac5991728fd08b565423614554976b5c25ad5c93bc898eff54903bdcd6d801eb2e09b92fb822a086c10cb17a435f872e3c025012322423514137eaa69775f30f166b027180dec69d92f6c1ba0ef439ede1165ea69382ef1eae1b13ef6872fc10b5d36cac958231bb06ff1b201c2156cdb0b3e214114bd1ee5007897eeda9f84d130c2088a0b12e31df9ef08182d847a36091425b0634bcbf0e1f72e8502eecc3c273c29a703507a1dc070a07e7062914369eb0abd183c7ecd9bd2f86f637b82677145293d32bd286879e29fc98c5a77fc8ce9810fdd8343f02ae8068a71610f6fd31ff5280773520788a56907c24e8ed042ec39b4ad20381731e10c71cfb41749fc6b94afa8f0cd45df8ebf83ed0786347647bf23b94327273e0b2626802b64afb807359013ac0143e52236582274c10a225ad2332cc665b143d1914baebf6d0b16195db819d05607dea518fd6828882c36421023508b241608e7f6af498a5332397d0221af2481ada8f219f16939ad8418ec61ccdca8da1de69499f0dce8513383dbf277bfa47e9e2541faa73f06a8546ebe59ca87d32f4260581472d9c43ed17acb1dc0dfeec6725c2c0f9d1fd6b534fd3a0aeb155eb69d8dd87a4a7b53df0855558c623d04b78629a2251c0c1b8633c0d1573aa33125d463840a670ed416cd7fcad130a7940aa2a215ab42c3385ee4cd936c63b3639d95c1b18f3466eafdfd9a1fe7a734d43554ba0865d218d2be44df5f6f76514fa8d304dcea8e0dfd7f683c6ba76a0ca0ff0cfd001dca4ee5c756c77170b09fb1db973a3a9a0c20809cef60c15f57042e0f12dbd4760c29daaa387b57af4c783aa6280b72ce406664e749e37626536f449d702087a937be5f8c8ff7994372b9dcc2db937cb9516d643ff8023a60d3e33f59eb90c13647e36917c860fdf6a86ae391b7795ea48696506f84f9674cb8ef7cd48205308187c8e09389b87b38530d4161d427cbc48ed967e2b3d5e4feb1c2c76e0a0e058e5f07afd4cabd889ba6cd76544a1a44a359991ecf1b39f438d4c2e7812b0c2713360f0a9f0bb3ecd105af90fc8a20b76b480b8b9a8beec805c8e2ce73542f58965bf288c4f0e59d4c3cf7e7e20256309f94e4041196f1a7596680ce070d8750a09f0da82c646dc44728e795d7b388ffff7976c48d5103e03af120807d7058551d6d444829b1ca917a36f89410da145600bf8ba294dcb293e3d6eb5cb53e2954ed9f958ca207aa78c2cf8784bc3c23087bb61045f62d3fde21ffb69bc04cf4eeddcbbf1f26c4a0aaef56ea8b70da4f7681ad991f9706bb69eaccc69f0952526f78c2e19ee8d95c73748224e9178653f4792bcc18732ca7fe6f0dc5f75fb37ec9677c3c705d14b10c6e692a7932ab152c5fd0ec3811536800a225d765dc17d8e753052099464390d70da8ec48ed444240edd5655d5be36966a6108ee0272427409e28e0a949bf37cd967983b89ab0ed20fd2844bb434fd03fba262a07de2224308b104a549b7f1fd0604e0bedbf54cbd881258772d0a122fa834700d1c3e9325840283f39e14ea99a6938b59599ddcc2227724169cccf51365947572fd566558395ef703ea07e5a62185361e01eefc9b5ceb74c6fe9a47509ea40ec9e8d7a71d8366bd6966a24edd57dc1d6176cfecd9ee6cd40f47699b284896687777ca5ebc856c4e348c09deb1750aa782ce2bb056a06d2eb0244178877c3638268c96e9dbf683384958720a4c775413a011a60543f556720fe9e892d6b9f3f6ed96729d6dc2daa8c70546c4cfefbdf633173ecf1847700d5f6c796927bd04a8486d75d16c311ec2d71452f33ece288258ae7968d9e04331b1fe4f18e9b816f4c947d8313ba80107ee0ce7d4390beeafcf87730139a95ee6e4f3a037f5e0f1572c1b668050caa12140678cd17d657b1bbfe8e21c5998e4198053998ec3ed741aee78afcc83fe872d9a1a100ffa75ca71a6b5e562586f5ed5740cfdec30a806aee9d3c92be283e5453594fe8ffa0397c4b41ff3e9fbca489f1ba3c04001d297db7cabfda97840e9caf8ae57ba04b97c17e715d9f0dc81b2b5307c525cc7f461b93eef7a4aa91ac2b5268cc6d8c269951d0294c6c0cd88a765339c1b0fb6e859113195245f20a63bc988ac83b57f990868b97c675370d27304b5e28b5170e16cb95c1dfd86990e0d8f1e54df8920d751e0b0dea58eb9238c6bd542ca1f12fa2791c579c872780dece3c1d33987e4f3c79eaa2e580beed9b5e4dd8d2fabd2dbae3da81f455d857a3c97e9a0e0652a2043308d0966d57e6d9032b245006e723382f730768aa0f57ffeecae3983557eb541e8e47e111e41813735857ee432a1df14c6c4b678c4300530dbabdc917e454e44ea8a903d598b18ea3f210353d91e5f01f6d6affc0f4a472101a72af4c6c15471eab2aa0253867eae2a1a671a79794622a37675e10263f3185dd37e8c6016f79094621c3a0879b2d2eec60359450db0e4ef6497d3e04ff30c6d3946f32b20669acfbf50e735305c5fa306b461109a3f936515e62eb86c9fe6cd725b006c11f6330674e74cde09343c1f4fd46eea52d03edd46adc917b4587764b7768c6b7d4e919c0582fa6e3ffe5ed3e0ed43856c62b02a8610d4f5ef2631f1c35b760ec2a8a6b71ba0b04ce05b0b45a1112c6f3403ce14aef491f5de8b96b059a7d7f3b1023cbce1bdb09aa89c92a27c1d3599c9519fc52e2dc68f1de999ecbdc0800eb7f0201572360ab01a0beee7569f62fb71f0ce0d1003f49fe62cacbe229aabd9953930a5537709dc60d34bf22fcd3a8728ef880afcaa02a1a394eba87a235437edda2b9941453da61ceff8b2f3dbd716af71abe70055d6ef939981e587acac5a690f8bfeade7485d21cc4b947a8cca0b92fe3a7af38419cb88a673f8001e9d37d0e8ca0faa28f8a16af555fd30b7133b38d8f95a5ede9232756e83b4a58a3c83a35d3252c318deca9203b4a6c9f6e824bb39f4795cc35fe72db0e9c60a5cc219932d9f1f7f286a61c7e7a09612c6d511dc4950518fea191354d1d7752642d51e5ac3ffe02d85ebcfc69141061e23e216cd6263201a71f17b9c76a95462256882fb14681c5329d5afe90778905473dfad821dc32402692298f3f10e952b40cc0a10372be431386b3ecf3c3ef1c03f7a7204543d6951d2147b0a61b5484ea9872f81c37757144b75b2f245614b5bd81f0f4f77967e31c573838e2600c56874ebe41bdb46a69f4904e40cc7da070c723668f51982710dee91843f29ed3fba032992017493bae14c6a641083308a17d28595d39cab0493ef71eeeafd44133976dc3611c6374ea9b5acb526da80045f5f95768344efa23df63fc32edc26989738e7885e72ceb614347f078aab3766977eac06f8b26f15de5cc19243cff3c3e6a7d8b7b3473e9e38767d4c9055c023c4ff10d10a174fb966e76644bf7efabb48eada49770940371ee8075a19a9a659d49e008093e17fce6768364efbeac5b359a15b8de510a389018fc6f8d11a9f6b9f47a721f533a0ff6ae003aa203d3144b9c17697cd598cb7bb228203d62d784aab6d7df914e3b17bf63bef839ea88c3202980a3595fcf17d1ff7234d93167a0fd5ec95c4b1b07ac025eb72533b414c63353dcf57665416ec43fdad1304b0229170018d2865661b3df814a12e91864d6ffa9ea4a57ddc763a6aa85457e1259cbd1cbb94f90fa5099fcb35af256c9f5c0ff7e3b598f1d908a105f590d7e55a6475a4919d03b0154dec378c659caed3db70a628e93ca2cb38ba8e17c8821e682e658d55da4664c7627908ce1f040e51c59391ba721b7094fc4f620abea63949e1448dfbf3f52ba14859390cb26c5f8cab57dbdb854174d4476f4ea2d73008c7bfa92a8e3ddbfcfbd97b070ea6bd811b138b4316b9db9131a1ee0eb9ff0943e3ce93cd4d1b6f15fd463854d72b331c05bc0ff1b2dfe4bb906130ccf6e0ba4b3929b6af58c74dce829302a26bcd0879d365f2c2178d039075f3af776eade4be3175ccda8c7bf8ebf5b7be6505aa1dd3f3f71cd376dbd01733d1768c715dc91631d47cf5465b3ceec93be3cc15c4ec091e2bf81985a59ae175b62edb32aaabf3d486d888ebce2b6c5b4d7ecff49eab597a29471a587ce1178b14299cc013fcb3c84be6b281ad4c928b6bbc9d7301846414d36876f8426a9ee6d08fe0520ff4fa423282f6f6d011cd2fb0483b97c5e79da8a8868634fc2ae02743cfd4b1096bce3b0ec07f81daad25c01529d4da0ab369e1e83ee7f92b049cc821edb9dd645968d8a46bad8ece794c662e9b7f15d12d9e2f71d01389b23d4aa0783b98d52e3807c09794111f609f4a99538969dec9b5fe5a3ce7441983a15a6d599681f41c1f7ee793322b9669f6e8e9f25ca29843f89e7afad43687747cdf4fecce44376d2038c97c9d9a8ddc18ce5eb3cf03edaa38acdaa4be18dd717db5c4d387950189fd7dd117defdbd822dd87ede48bafa5c267add2d5114b51c7f8e9007fa07ae1d4ec6feec4b66b96166ff528e29c9b9148ed9184f173c64ec42f020061431b8d821b92957330be7ea0963d40ebe8db8dc30be5a5a00c365f09573f25b73067d0570b685b86c0001aaea8ca388059087696cf36ff12cd7601b52931a4266e6091f7f3767e7be7a699e5286d659999eff00cba38077c43f807b20c831f1e2a6f396557c3423c60da3dc37133780f11107540cd3447ea7b35c76dc77ea229c3f85db2a7213d46e779435690fb7943f79312c7aa5dcfadf0e14cec0d538303705495bb98e58def10c3fac08de5c30d75e2a1cd99f3267e8131076565c634ee5d37037a6da170b31a7fdf9416a3be053069ad98830443dc778f21f457b6ac3aac286ca86a586b0405f189c92123ed2c4a1d6c83b3604854cba6aea975048e4d850bb9e614b9f7163d0dfcb799ae2d81212cb96a91479517cd3744a0bf18054ddaafc1dfe9b42e45cf3386d53cdd056983027624729bd347dca0b651379aef6a4bf0ed08664385d80f4ee96473f5838c9118df5e115eb6fdf111241898cd9400a05862abdbb1b07a2f9e55db559cabf88b39c4070633b1b1e958fe54c213c044805c3e7a14b862bb2bd1e593a502b5ae882f3eef26f13b07174955cbece4a5253587c7cafb13caca170bd537b039c96afa553afe5d5d6dfee76ee758702d805ae5732295c8183ed6928a2ad9fda9685dc48d906d2d4cf2c7194189e6b2822d8c63b124926a9c04ff86c3a5e70862a4523c23c1399be77f7bc654cf87cd0a7c69a05f5b7577796eb41268aa9eb35cf574be6a51a67035a7056739fdeda8c986bd68e074ec6a9be634e44d141c0b984ae92c3ed2a296f571b9515361ed33185d48f5b8d266ea5dc837b24160b6c7439a7df80ea3cfc37ecdf543c21bc8b6d5871b9e91a8315f03a9398d28e9a512d86e04869316cbcceb43934dabe60a093cf65686659b694b395ce0f4c51483f848ae58ccfa4176547be0b08c67af94b1c337602a1b82dde936bb0d99c7eb1505295eedbe9d99dc3dcdc2ee79cf082dda314b73e7356217c6dbbc955105c9efff31af7062f6968f5a7b17d98efba666d7de1f96c1e3bd07d862f03e50c7cfe450c01cb3aa936fe2d8ed929f621aa4e3ff08c656bafe13113ba1a5c14b8098945c3f4b3d64da1c2095fb355718ba8d61f2ba495d1054b53f7bc31981bcd877977e08094fa816d0c5b14207352ac357d92baabc11dc5ac8463c80f4ce76d525bef5d9bb14c826889b72a50debd850a084c933edc3e69f0133b19ae40618c48666028a31e3283397f1573a1ad9e0a3bab2490950ed6b4e6e495c75e54235a7d5bdf0a927635693a3c49bfd55072c249659e91bcff32971006e2a028f614bc1841b31da2a0a26acc85e81e110323351f33ec41816b10448fea0fcea0abcff523d6314c2954db8b7a7987ce095b406cbf7dbd6eb3037880a95be7a331f7a8f23ebab50c478eed256e73830b4f17bbc34f7838e8bbcc68cab8c45e6be2f9dc7f268c5bd6607d37f064f4acb2355d57084ff6c2f6a585df924fad8162ba8e41fe846fdd2cd90b11d9d292fbca74c98bbfe748203c8c78219b9fab91314a54f2c3e08923065828e8a91d9998992d41b8b4d01d855c1205f2a50549b36441a2de4387b2b61e12342dac8c25e87329b9a0bd1092f3e6337929046eff3c224f9d99af22d1a7a923c0946668185472af51b8b0fdd27ef9607148518d9d8a48dc4fb8aceb343cc07cbd2ab2bebfd86736c7b22549a07b3c39dbf49e25e286a81aeb029af1d6cf11235b5df1c585295341589ac6b63f72397ccb484b873f497709f12095a93799c1da5e3657215aeacac575ffac3d0c7657f4c641cff7e69ea8d09b994949ee2a482b6a81e7e1bd42008ac115d21a2b3355c3e197461716bc9a2a94ff17107e07004cf0ef4a7115b60863a71afb88d7a324de37d8602d0a45315edb29729c6b3ed63a40acc505b93ba18519956f20be069dfaef1043b0de82fbd0d97fffb5677e79c13b261b41daf81b295d4d25a6144f318ce7aeae3147caed005094951383ffa7d2625f99654181ac2d5b1d3a205d629748c169f9df20dcfc2adde5bc406d15b846532cbf468f5b05d9085a2af43ac28b0f5d8b6ef7cdd77ccf93fe0c20291366dd3a5b9d9877c2b12a6aeed320b0287cc1e44681ca80a0a9d6426b762e8e2c0eea4109ae1108dd78b1c5c15c4a0b39c9cdb053cba0f8f4b9d22306f7fb3b7ec198e00a3e6040a4c148ffc97138b945db28fab78b8416f604fd2e5fd7457b3c95dadb1721608b6321c61f798a671aba81b59524796905446a43e2384a594a4f8d7465b1cd64e2ad9d16a95bcf0807750aabb779cf761df5a32ee318e24de5c147654bbf79a6c45852e06887c81b9fee13b33ca16c524d24f803cf04913b36777cfb215626fa7eb59476de6bb4e0e97ab36bfd837a4f2346f94e09d5cddc04c97e651fd2368e64bc16c2b915546b9adef3775cdb2130574e884fc4dc73f5d69c29a47f5c235811f572066115bcc02c2fb2af68e790ba7c77f8ca5fb5febe59985a1c263320b4c00b36a56bb64fd5425dc61e8ba30372badb1d2406ee87c2158fd607961ba4d25800bf1f116b3886058c273f307081752e6bf3dd5c6e024fd2062ca8880531dd4bcb8be9b58377740ce91c010d084586a2c8788ead97ab24e9d3febac2c6584ca160f658255c305d29aa72644200a6ae906a8d52c43f8982a5fa61abaaff62f5e42970644a81c9011dcaee4dec623fd9a8c2d5868a433b679fbfc8df060ae1b3e749222b5b30c66b9d89efeeda60d9d3266f1dc10c9182c43e69595b25e5d93dcab3c4f23d282145720c1d222d61ccd2aa23d41e880bc29afc41d56c18557b01d178ef8d9fcb280e6ca16ccfcf3aa795d7204ea2bdf6e451465b33e38ffcc5d079cefad792f46f09301eee083773a4ad23d48cfdf17efc036e623f39322a502a9a234f2df702f08b9555d892fb875b9cb1df3f1b2b59002b535b99c7c054fb30a771ecc91fb9dbce66674dd2233e1ec36c9f4e09ed47be2da6725880a2a38334149bb514d85d7d12f0abfa8dfc3a0bfc6e7a7ab0640f5f8d605471e7bbaea1c8bb7ad2e58a77905277bf6d0afe91824cd5469e16e306b54a179970a44b8ef42d82b4223b43fad914bb0d11bdaf65d145d30caea3c0daa793779ffd040892c67bed85213875a41cc4a836a6f31885979dbbf2915577443f2fa2843d31c7d8ea25f9aa2ad7aad284b5c778ed48f5f457ac6cd8fb91cc48a1e965e2981ccd2dec66846bceb0183b4975a3c838408989d1c0d7cdcc1435f1afab9d7e4f5e775d79aa4ed8d70095c2391d438692d60764ba9650f2b96dbf726695a51c59e07fc007876f5302dbc946071365d9961e2e570d6bf4fa36fb684fbdce3c3d9ed57a35779a50238669691ea34079b9d4144db1342b64610f9c3696d1a1a94e7175d8d23a7a1345151cb8efef52daf0e24bd24495407ae6bc98656311b2fb394baa472ceb84709783d4ba71c9a6fbd494e6ae9a96811e5f3cd7c7387918fc835fc2676ed315193094f18ebceb87da098ec5d895e0da5dae69ff49a6a22d79b2645afa26f168c9231316b8455ce81f79689531207781f07336aeed52a81c76d7b86a860f6159c9b566ea6c4b9d6bf4ed03b1abd60dafcf528583ab1c455bbe1d6f41eb02cd46a389ebcac7127c3839478f9e32d4001df6c2acbd940f02323c61077223cb1d1152d9f92c43c8703fe1f7d15632f1689095b17fe66fa9864691350517a10ad578ea39977ecf40f7c86b7e78d75a75a7fd82f256cffc54e5b739a3a928c214f134391322ac475de519b64f1deb3af14581b3c1863cce95adce38290875f5635c7b0bd922e8c36e34999caeb430073fdc2638dfa81279bd6a36802db91567def92724cfb966fed08638a378eda79daf7a32338f6d000a491aa953f3f7a16e1e0c1e0a3376a735c9099e9e432b9ea4626541f12820291d48288a87327c76170cfb259ba024bcd73fa24a1629539d12d1a8df22b704bbce8a8e52cbf89706bd1d1f604cd87afc83e16290a624e1028c68e2de7aea075af5b2b0b5b8c0b665b32ba5a62a8cd4a9599bc6aaa48a298170272d59fcac4d2b150b1b2f1741877c46aa20d4b11bfa2b1a6c7582030ceb2a63357945a3d24bf706e9ca3035d303f2dcaba1dae475a7e1c21c1be287b133a8074fe8f14e661550978037127efd48fc4d5bfa4dcaea9f44c012d95b025c63c755138d90d7a35fbd108b6995697703415e29a9b6931e9dff9cba4ee1d9bcf574b7fa8c5b4d68d9824f47f356f9e92f3cdbcc729ff7c5d6f66e7af8a2479863ae9b808136d4c2f688fbd2e62f4185d8761e359fde65b1268245a416ad23071063b73ba3cecc46fff68ed8ecbfde18e37e6f2128f829ca673593aa9837ee3c4067d5070b067a04292365fbb2b58ea944694755c1c7bf80c5bc9c2419be78589ea77db71eb620b80f438bcae6c034dac1f968bfbaca24794853938fe0df2bdc4ed4bf802b837749d604b3f298a432c9f553ae97b4cc690d0f208c75f9a9c5a3cc6f84d14603f5b2afb1bbb41e9ac891a6263146cd8191a73b964815b745b7fca694cf1961998865d556ff2474151485873b1765b370940a365cb6fbe5cc11e31ad69a9a14e695ecbfab6ae6054a3e6292d4983de0af01e09a4a04b603a41929ef5f0bd826c600a892baa834492f09bf9f87514d2ddadcad425ab6628d9b380bf589b5ac53220d8471ab2ebdac3ca0b5799c364d84d2ac2b78280b216aabfb3bfea457b0ed4b2412a40281cb10c00e7a99613eba58cfff2b0f0b31f3b73d2e5cd0fbdba6a005202548e273645d735fc41885d1bcd0cf4d19215acdb1925b0206e5cb9b64e51e1f2d3dbf19074832a926c317a8b9c08134cb7907a70cd11868ce1f614c8a46cbace52da15b0841617199246686070b3dd1d3acf44af888dc6fe083caff84288524896e57c45c15f4d13445363cbc5dc2b414c2334521020c68b00a089bbeee8d92324cbbc166eecdee2e6d15d0e09e96b6f636f3a1c67cd40d983b06955289a4ee8e6fdf74989486cc2b57d572a514eec685ac99497e803263c04fcfbc19e18687d98fa2e2595d535b3b1119631744ab9befaaf23c7d45d2b887247d2e2e00fcc517d1e40908878efb289fe0f4f942fdae16466b77111632c0bf2ee38723e6b9ebc5ccdf14e880e46872a825c3ed1e6d05db14001b2df4774a7b474dc40010e9b4a6e343dddaf1de2b0abc5f49148474ae84dfb5d2a67daf243283eddf4b4c6b76ef68e6b92a4b36a1cca82f767e8370b583412e89078de311169df35cd59a07d6631ec7451ee0e73fdc88b0936ad3c1a1fa8bc2c68cdc67e101dfd107d3fc0d366acf7cebb1df9913977532e77802a4c92af35428fbd545bb54666bd886741cc69073b6dc7a5b4649294c2c9ad9ba1e2c31e25a3c54734ef0738d47675787061c538659e29b1e5c3496cc7915d74667bf7d9ca1540f604f3a445b97d92686b6390d09a7986","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"4290edf5ab9c348d0d7d0b9e329b1e38"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
